{"version":3,"file":"use-async-queue.umd.js","sources":["../use-async-queue.js"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from 'react';\n\n/*\ntask\n{id: string or number, task: function returning promise}\n*/\nexport default function useAsyncQueue({ concurrency = 8, done }) {\n  if (concurrency < 1) concurrency = Infinity;\n\n  const [numInFlight, setNumInFlight] = useState(0);\n  const [numPending, setNumPending] = useState(0);\n  const [numDone, setNumDone] = useState(0);\n\n  const inFlight = useRef([]);\n  const pending = useRef([]);\n\n  useEffect(() => {\n    console.log(\n      'DEBUG: useEffect called',\n      numInFlight,\n      inFlight.current.length,\n      numPending,\n      pending.current.length\n    );\n    while (\n      inFlight.current.length < concurrency &&\n      pending.current.length > 0\n    ) {\n      const task = pending.current.pop();\n      setNumPending((n) => n - 1);\n      inFlight.current.push(task);\n      setNumInFlight((n) => n + 1);\n      const result = task.task();\n      result\n        .then(() => {\n          console.log('DEBUG: task resolved, calling done');\n          inFlight.current.pop(task);\n          setNumInFlight((n) => n - 1);\n          setNumDone((n) => n + 1);\n          done({ ...task, result });\n        })\n        .catch(() => {\n          console.log('DEBUG: task rejected, calling done');\n          inFlight.current.pop(task);\n          setNumInFlight((n) => n - 1);\n          setNumDone((n) => n + 1);\n          done({ ...task, result });\n        });\n    }\n  }, [concurrency, done, numPending, numInFlight]);\n\n  const add = useCallback(\n    (task) => {\n      pending.current.push(task);\n      setNumPending((n) => n + 1);\n    },\n    [pending]\n  );\n\n  return { add, numInFlight, numPending, numDone };\n}\n"],"names":["concurrency","Infinity","useState","inFlight","useRef","pending","useEffect","console","log","numInFlight","current","length","numPending","task","pop","setNumPending","n","push","setNumInFlight","result","then","setNumDone","done","Object","catch","useCallback","numDone"],"mappings":"qNAMe,+CAAuC,gBAChDA,EAAc,IAAGA,EAAcC,gBAEGC,WAAS,mBACXA,WAAS,mBACfA,WAAS,iBAEjCC,EAAWC,SAAO,IAClBC,EAAUD,SAAO,WAEvBE,uBACEC,QAAQC,IACN,0BACAC,EACAN,EAASO,QAAQC,OACjBC,EACAP,EAAQK,QAAQC,iCAMVE,EAAOR,EAAQK,QAAQI,MAC7BC,WAAeC,UAAMA,EAAI,IACzBb,EAASO,QAAQO,KAAKJ,GACtBK,WAAgBF,UAAMA,EAAI,QACpBG,EAASN,EAAKA,OACpBM,EACGC,gBACCb,QAAQC,IAAI,sCACZL,EAASO,QAAQI,IAAID,GACrBK,WAAgBF,UAAMA,EAAI,IAC1BK,WAAYL,UAAMA,EAAI,IACtBM,EAAKC,iBAAKV,UAAMM,OAEjBK,iBACCjB,QAAQC,IAAI,sCACZL,EAASO,QAAQI,IAAID,GACrBK,WAAgBF,UAAMA,EAAI,IAC1BK,WAAYL,UAAMA,EAAI,IACtBM,EAAKC,iBAAKV,UAAMM,QArBpBhB,EAASO,QAAQC,OAASX,GAC1BK,EAAQK,QAAQC,OAAS,QAuB1B,CAACX,EAAasB,EAAMV,EAAYH,IAU5B,KARKgB,uBACTZ,GACCR,EAAQK,QAAQO,KAAKJ,GACrBE,WAAeC,UAAMA,EAAI,KAE3B,CAACX,gBAGWI,aAAaG,UAAYc"}