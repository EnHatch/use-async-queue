{"version":3,"file":"use-async-queue.umd.js","sources":["../use-async-queue.js"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from 'react';\n\n/*\ntask\n{id: string or number, task: function returning promise}\n*/\nexport default function useAsyncQueue({ concurrency, done }) {\n  if (concurrency < 1) concurrency = 1;\n\n  const [numInFlight, setNumInFlight] = useState(0);\n  const [numRemaining, setNumRemaining] = useState(0);\n  const [numDone, setNumDone] = useState(0);\n\n  const inFlight = useRef([]);\n  const remaining = useRef([]);\n\n  useEffect(() => {\n    console.log(\n      'DEBUG: useEffect called',\n      numInFlight,\n      inFlight.current.length,\n      numRemaining,\n      remaining.current.length\n    );\n    while (\n      inFlight.current.length < concurrency &&\n      remaining.current.length > 0\n    ) {\n      const task = remaining.current.pop();\n      setNumRemaining((n) => n - 1);\n      inFlight.current.push(task);\n      setNumInFlight((n) => n + 1);\n      const result = task.task();\n      result\n        .then(() => {\n          console.log('DEBUG: task resolved, calling done');\n          inFlight.current.pop(task);\n          setNumInFlight((n) => n - 1);\n          setNumDone((n) => n + 1);\n          done({ ...task, result });\n        })\n        .catch(() => {\n          console.log('DEBUG: task rejected, calling done');\n          inFlight.current.pop(task);\n          setNumInFlight((n) => n - 1);\n          setNumDone((n) => n + 1);\n          done({ ...task, result });\n        });\n    }\n  }, [concurrency, done, numRemaining, numInFlight]);\n\n  const add = useCallback(\n    (task) => {\n      remaining.current.push(task);\n      setNumRemaining((n) => n + 1);\n    },\n    [remaining]\n  );\n\n  return { add, numInFlight, numRemaining, numDone };\n}\n"],"names":["concurrency","useState","inFlight","useRef","remaining","useEffect","console","log","numInFlight","current","length","numRemaining","task","pop","setNumRemaining","n","push","setNumInFlight","result","then","setNumDone","done","Object","catch","useCallback","numDone"],"mappings":"qNAMe,yCACTA,EAAc,IAAGA,EAAc,SAEGC,WAAS,mBACPA,WAAS,mBACnBA,WAAS,iBAEjCC,EAAWC,SAAO,IAClBC,EAAYD,SAAO,WAEzBE,uBACEC,QAAQC,IACN,0BACAC,EACAN,EAASO,QAAQC,OACjBC,EACAP,EAAUK,QAAQC,iCAMZE,EAAOR,EAAUK,QAAQI,MAC/BC,WAAiBC,UAAMA,EAAI,IAC3Bb,EAASO,QAAQO,KAAKJ,GACtBK,WAAgBF,UAAMA,EAAI,QACpBG,EAASN,EAAKA,OACpBM,EACGC,gBACCb,QAAQC,IAAI,sCACZL,EAASO,QAAQI,IAAID,GACrBK,WAAgBF,UAAMA,EAAI,IAC1BK,WAAYL,UAAMA,EAAI,IACtBM,EAAKC,iBAAKV,UAAMM,OAEjBK,iBACCjB,QAAQC,IAAI,sCACZL,EAASO,QAAQI,IAAID,GACrBK,WAAgBF,UAAMA,EAAI,IAC1BK,WAAYL,UAAMA,EAAI,IACtBM,EAAKC,iBAAKV,UAAMM,QArBpBhB,EAASO,QAAQC,OAASV,GAC1BI,EAAUK,QAAQC,OAAS,QAuB5B,CAACV,EAAaqB,EAAMV,EAAcH,IAU9B,KARKgB,uBACTZ,GACCR,EAAUK,QAAQO,KAAKJ,GACvBE,WAAiBC,UAAMA,EAAI,KAE7B,CAACX,gBAGWI,eAAaG,UAAcc"}